<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Alencar Fretes ğŸï¸</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="manifest" href="manifest.json">

<style>
body { background:#121212; color:#fff; font-family:Arial; padding:15px; text-align:center }
input, select, button { width:95%; padding:14px; margin:6px 0; border-radius:10px; border:none }
button { font-weight:bold; cursor:pointer }
.calcular { background:#00c853; color:#000 }
.whatsapp { background:#25D366; color:#fff }
.salvar { background:#2962ff; color:#fff }
.perigo { background:#d32f2f; color:#fff }
.box { border-top:1px solid #333; margin-top:15px; padding-top:10px; text-align:left }
.item { border-bottom:1px solid #333; padding:6px 0 }
</style>
</head>

<body>

<h2>Alencar Fretes ğŸï¸</h2>

<select id="clienteSelect"></select>

<div class="box">
<h4>â• Novo / Editar Cliente</h4>
<input id="nomeCliente" placeholder="Nome do cliente">
<input id="numeroCliente" placeholder="WhatsApp (5511...)">
<button class="salvar" onclick="salvarCliente()">Salvar</button>
<button class="perigo" onclick="excluirCliente()">Excluir cliente</button>
</div>

<input type="number" id="km" placeholder="KM da entrega" step="0.1">
<button class="calcular" onclick="calcular()">Calcular frete</button>
<button class="whatsapp" onclick="enviarWhats()">ğŸ“² Enviar WhatsApp</button>

<div id="resultado"></div>
<div id="aviso"></div>

<div class="box">
<h4>ğŸ“… Filtro por perÃ­odo</h4>
<input type="date" id="inicio">
<input type="date" id="fim">
<button onclick="renderizar()">Aplicar filtro</button>
</div>

<div class="box">
<h4>ğŸ“Š RelatÃ³rio</h4>
<div id="relatorio"></div>
<button onclick="exportarExcel()">ğŸ“¤ Exportar Excel</button>
</div>

<div class="box">
<h4>â˜ï¸ Backup</h4>
<button onclick="exportarBackup()">Exportar Backup</button>
<input type="file" onchange="importarBackup(event)">
</div>

<script>
let clientes = JSON.parse(localStorage.getItem("clientes")) || [
  {nome:"Karla Brie", numero:"5511968971239"}
];
let historico = JSON.parse(localStorage.getItem("historico")) || [];
let ultimoValor = 0;

function salvarLocal() {
  localStorage.setItem("clientes", JSON.stringify(clientes));
  localStorage.setItem("historico", JSON.stringify(historico));
}

function atualizarClientes() {
  const sel = document.getElementById("clienteSelect");
  sel.innerHTML = "";
  clientes.forEach((c,i)=>{
    sel.innerHTML += `<option value="${i}">${c.nome}</option>`;
  });
}
atualizarClientes();

function salvarCliente() {
  const nome = nomeCliente.value;
  const numero = numeroCliente.value;
  if(!nome || !numero) return alert("Preencha tudo");
  const idx = clienteSelect.value;
  clientes[idx] = {nome, numero};
  salvarLocal();
  atualizarClientes();
}

function excluirCliente() {
  if(!confirm("Excluir cliente?")) return;
  clientes.splice(clienteSelect.value,1);
  salvarLocal();
  atualizarClientes();
}

function calcular() {
  const km = parseFloat(document.getElementById("km").value);
  if(!km) return;
  let valor = Math.ceil(km*1.9*100)/100;
  if(valor<5) valor=5;
  ultimoValor = valor;
  resultado.innerHTML = `ğŸ’° R$ ${valor.toFixed(2).replace(".",",")}`;
  historico.unshift({km,valor,data:new Date().toISOString()});
  salva
